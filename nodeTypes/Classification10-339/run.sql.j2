{% set source = sources[0] %}
{% set src_node = source.dependencies[0].node %}
{% set analysis_node = sources[1]%}
{% set Classification_name = config.mname %}
{% set ns = namespace(colpredict='',selectquery='')%}
{% set result = ref_no_link(node.location.name, node.name) %}

{%- set nsVariables = namespace(squotes="") -%}



{%- for col in source.columns if col.predict %}

  {%set ns.colpredict = col.name %}
{%endfor%}

{{ stage('Insert Classification data') }}

{%set ns.selectquery ='SELECT '+' '%}
    {%- for col in source.columns  %} 
			{%if col.name != config.tgtcol.name%}
            {%set ns.selectquery = ns.selectquery + '"'+ col.name + '"'%}
			{%else%}
            {%set ns.selectquery = ns.selectquery + '"'+ ns.colpredict + '":class as '+col.name+"_PREDICTION"%}
            {%endif%}
            {%- if not loop.last %}{%set ns.selectquery = ns.selectquery + "," %}{%- endif %}
    {%- endfor %}
{%set ns.selectquery =ns.selectquery + ' FROM(SELECT '+' '%}

        {%- for col in columns %}        
            {%if col.name == ns.colpredict %}
            {%set ns.selectquery = ns.selectquery + ref_no_link(node.location.name, Classification_name) + '!predict(
              INPUT_DATA => object_construct(*)) as "'+ ns.colpredict +'"'%}
              {%- if not loop.last %}{%set ns.selectquery = ns.selectquery + "," %}{%- endif %}
            {%elif col.name != config.tgtcol.name  %}
                {%set ns.selectquery = ns.selectquery + '"'+ col.name + '"' %}
                {%- if not loop.last %}{%set ns.selectquery = ns.selectquery + "," %}{%- endif %}
            {%endif%}          
        {%- endfor %}
        {%set ns.selectquery = ns.selectquery + ' ' + analysis_node.join +')'%}
        
        {{ns.selectquery}}